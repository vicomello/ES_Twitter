---
title: "Main Analyses Bayesian MLM"
author: "Victoria Oldemburgo de Mello"
date: "23/03/2022"
output: pdf_document
---

```{r}

require(tidyverse, esmpack, brms)
# installation for esmpack available at github.com/wviechtb/esmpack

df <- read_csv("../data/data.csv")
df$affect <- df$positive - df$negative
```

## Positive control



In-person social interaction
```{r}

df$affect_lagged <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$inperson_lagged <- lagvar(in_person, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

control2_fit <- brm(affect ~ in_person + inperson_lagged + affect_lagged + (in_person + inperson_lagged + affect_lagged| random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

control2_fit

control2_fit_empty <- brm(affect ~ inperson_lagged + affect_lagged + (inperson_lagged + affect_lagged| random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(control2_fit_empty)[1]-bayes_R2(control2_fit)[1]
es <- sqrt(diff)
es

save(control2_fit, file = "brm_fits/control2_fit.Rda")
save(control2_fit_empty, file = "brm_fits/control2_fit_empty.Rda")


```




Quality of interaction
```{r}

df$quality_interaction[df$interacted==0] <- NA

df$quality_interaction_lagged <- lagvar(quality_interaction, id=random_id, obs=obs, day=days_elapsed, data = df, lag = 1)

qint_fit <- brm(affect ~ affect_lagged + quality_interaction + quality_interaction_lagged + (affect_lagged + quality_interaction + quality_interaction_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

qint_fit

qint_fit_empty <- brm(affect ~ affect_lagged + quality_interaction_lagged + (affect_lagged + quality_interaction_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(qint_fit)[1]-bayes_R2(qint_fit_empty)[1]
es <- sqrt(diff)
es


save(qint_fit, file = "brm_fits/quality_interaction_fit.Rda")
save(qint_fit_empty, file = "brm_fits/quality_interaction_fit_empty.Rda")

```
## Twitter use x Well-being

```{r}

df$used_tt_lagged <- lagvar(used_tt, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$affect_lagged <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

wb_fit <- brm(affect ~ used_tt + used_tt_lagged + affect_lagged + (used_tt +  used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=4)

wb_fit

bayes_R2(wb_fit)

wb_fit_empty <- brm(affect ~ used_tt_lagged + affect_lagged + (used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=4)

diff <- bayes_R2(wb_fit)[1]-bayes_R2(wb_fit_empty)[1]
es <- sqrt(diff)
es

save(wb_fit, file = "brm_fits/ttuse_wellbeing_fit.Rda")
save(wb_fit_empty, file = "brm_fits/ttuse_wellbeing_fit_empty.Rda")

```


## Twitter Behaviorss x Well-being
aqui

```{r}

ttb_fit <- brm(affect ~ affect_lagged + w_rt + w_liked + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled + (affect_lagged + w_rt + w_liked +  w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

save(ttb_fit, file = "brm_fits/ttbehaviors_wellbeing_fit.Rda")

```
```{r}

ttb_fit_empty <- brm(affect ~ affect_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending+ (affect_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

# effect size for scrolling down the feed
diff <- bayes_R2(ttb_fit)[1]-bayes_R2(ttb_fit_empty)[1]
es <- sqrt(diff)
es

save(ttb_fit, file = "brm_fits/ttbehaviors_wellbeing_fit.Rda")
save(ttb_fit_empty, file = "brm_fits/ttbehaviors_wellbeing_fit_empty.Rda")

```

## Functions of use X well-being

```{r}

func_fit <- brm(affect ~ distract + entertain + promote + information + interact + affect_lagged + (distract + entertain + promote + information + interact + affect_lagged | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

summary(func_fit)

func_fit_empty <- brm(affect ~ entertain + promote + information + interact + affect_lagged + (entertain + promote + information + interact + affect_lagged | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(func_fit)[1]-bayes_R2(func_fit_empty)[1]
es <- sqrt(diff)
es

save(func_fit, file = "brm_fits/ttfunctions_wellbeing_fit.Rda")
save(func_fit_empty, file = "brm_fits/ttfunctions_wellbeing_fit_empty.Rda")

```


## Twitter use x boredom

```{r}

df$bored_lagged <- lagvar(bored, id=random_id, obs=obs, day=days_elapsed, data=df, lag = 1)

bored_fit <- brm(bored ~ used_tt + bored_lagged + used_tt_lagged + (used_tt + bored_lagged + used_tt_lagged |random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

bored_fit

bored_fit_empty <- brm(bored ~ bored_lagged + used_tt_lagged + (bored_lagged + used_tt_lagged |random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(bored_fit)[1]-bayes_R2(bored_fit_empty)[1]
es <- sqrt(diff)
es

save(bored_fit, file = "brm_fits/bored_fit.Rda")
save(bored_fit_empty, file = "brm_fits/bored_fit_empty.Rda")

```


## twitter use x outrage

```{r}
df$outrage <- (df$disgusted + df$repulsed + df$angry)/3
df$outrage_lagged <- lagvar(outrage, id=random_id, obs=obs, day=days_elapsed, data=df, lag = 1)

outrage_fit <- brm(outrage ~ used_tt + outrage_lagged + used_tt_lagged + (used_tt + outrage_lagged + used_tt_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

outrage_fit

outrage_fit_empty <- brm(outrage ~ outrage_lagged + used_tt_lagged + (outrage_lagged + used_tt_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(outrage_fit)[1]-bayes_R2(outrage_fit_empty)[1]
es <- sqrt(diff)
es

save(outrage_fit, file = "brm_fits/outrage_fit.Rda")
save(outrage_fit_empty, file = "brm_fits/outrage_fit_empty.Rda")

```


## twitter use x anxiety

```{r}

df$anxious_lagged <- lagvar(anxious, id=random_id, obs=obs, day=days_elapsed, data=df, lag = 1)

anx_fit <- brm(anxious ~ used_tt + anxious_lagged + used_tt_lagged + (used_tt + anxious_lagged + used_tt_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

anx_fit

anx_fit_empty <- brm(anxious ~ anxious_lagged + used_tt_lagged + (anxious_lagged + used_tt_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(anx_fit)[1]-bayes_R2(anx_fit_empty)[1]
es <- sqrt(diff)
es

save(anx_fit, file = "brm_fits/anxiety_fit.Rda")
save(anx_fit_empty, file = "brm_fits/anxiety_fit_empty.Rda")

```

## loneliness x twitter use

```{r}

df$lonely_lagged <- lagvar(lonely, id = random_id, obs = obs, day = days_elapsed, data = df, lag = 1)

lonely_fit <- brm(lonely ~ lonely_lagged + used_tt + used_tt_lagged + (lonely_lagged + used_tt + used_tt_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

lonely_fit

lonely_fit_empty <- brm(lonely ~ lonely_lagged + used_tt_lagged + (lonely_lagged + used_tt_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(lonely_fit)[1]-bayes_R2(lonely_fit_empty)[1]
es <- sqrt(diff)
es

save(lonely_fit, file = "brm_fits/lonely_fit.Rda")
save(lonely_fit_empty, file = "brm_fits/lonely_fit_empty.Rda")

```


## twitter use x positive affect

```{r}

df$pos_aff_lagged <- lagvar(pos_aff, id=random_id, obs=obs, day = days_elapsed, data = df, lag = 1)

posaff_fit <- brm(pos_aff ~ pos_aff_lagged + used_tt + used_tt_lagged  + (used_tt + used_tt_lagged + pos_aff_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(posaff_fit)

# empty model for comparison

posaff_fit_empty <- brm(pos_aff ~ pos_aff_lagged + used_tt_lagged  + (used_tt_lagged + pos_aff_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(posaff_fit_empty)

diff <- bayes_R2(posaff_fit)[1]-bayes_R2(posaff_fit_empty)[1]
es <- sqrt(diff)
es

save(posaff_fit, file = "brm_fits/posaff_fit.Rda")
save(posaff_fit_empty, file = "brm_fits/posaff_fit_empty.Rda")

```


## twitter use x negative affect

```{r}

df$neg_aff_lagged <- lagvar(neg_aff, id=random_id, obs=obs, day = days_elapsed, data = df, lag = 1)

negaff_fit <- brm(neg_aff ~ neg_aff_lagged + used_tt + used_tt_lagged  + (used_tt + used_tt_lagged + neg_aff_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(negaff_fit)

# empty model for comparison

negaff_fit_empty <- brm(neg_aff ~ neg_aff_lagged + used_tt_lagged  + (used_tt_lagged + neg_aff_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(negaff_fit_empty)

diff <- bayes_R2(negaff_fit)[1]-bayes_R2(negaff_fit_empty)[1]
es <- sqrt(diff)
es

save(negaff_fit, file = "brm_fits/negaff_fit.Rda")
save(negaff_fit_empty, file = "brm_fits/negaff_fit_empty.Rda")

```

## twitter use x tired

```{r}

df$tired_lagged <- lagvar(tired, id=random_id, obs=obs, day = days_elapsed, data = df, lag = 1)

tired_fit <- brm(tired ~ tired_lagged + used_tt + used_tt_lagged  + (used_tt + used_tt_lagged + tired_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(tired_fit)

# empty model for comparison

tired_fit_empty <- brm(tired ~ tired_lagged + used_tt_lagged  + (used_tt_lagged + tired_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(tired_fit_empty)

diff <- bayes_R2(tired_fit)[1]-bayes_R2(tired_fit_empty)[1]
es <- sqrt(diff)
es

save(tired_fit, file = "brm_fits/tired_fit.Rda")
save(tired_fit_empty, file = "brm_fits/tired_fit_empty.Rda")

```


## twitter use x sense of belonging

```{r}

df$sense_community_lagged <- lagvar(sense_community, id=random_id, obs=obs, day = days_elapsed, data = df, lag = 1)

sense_community_fit <- brm(sense_community ~ sense_community_lagged + used_tt + used_tt_lagged  + (used_tt + used_tt_lagged + sense_community_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(sense_community_fit)

# empty model for comparison

sense_community_fit_empty <- brm(sense_community ~ sense_community_lagged + used_tt_lagged  + (used_tt_lagged + sense_community_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(sense_community_fit_empty)

diff <- bayes_R2(sense_community_fit)[1]-bayes_R2(sense_community_fit_empty)[1]
es <- sqrt(diff)
es

save(sense_community_fit, file = "brm_fits/sense_community_fit.Rda")
save(sense_community_fit_empty, file = "brm_fits/sense_community_fit_empty.Rda")

```


## twitter use x well-being controlling for sense of belonging
```{r}


df$sense_community_lagged <- lagvar(sense_community, id=random_id, obs=obs, day = days_elapsed, data = df, lag = 1)

wellbeing_communitycontrol_fit <- brm(affect ~ sense_community + affect_lagged + used_tt + used_tt_lagged  + (used_tt + used_tt_lagged + sense_community + affect_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(wellbeing_communitycontrol_fit)

# empty model for comparison

wellbeing_communitycontrol_fit_empty <- brm(affect ~ sense_community + affect_lagged + used_tt_lagged  + (used_tt_lagged + sense_community + affect_lagged|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(wellbeing_communitycontrol_fit_empty)

diff <- bayes_R2(wellbeing_communitycontrol_fit)[1]-bayes_R2(wellbeing_communitycontrol_fit_empty)[1]
es <- sqrt(diff)
es

save(wellbeing_communitycontrol_fit, file = "brm_fits/wellbeing_controlled_fit.Rda")
save(wellbeing_communitycontrol_fit_empty, file = "brm_fits/wellbeing_controlled_fit_empty.Rda")

```


## lagged twitter use x well-being

```{r}

df$used_tt_lagged <- lagvar(used_tt, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$affect_lagged <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

wb_lag_fit <- brm(affect ~ used_tt_lagged + affect_lagged + (used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(wb_lag_fit)

wb_lag_fit_empty <- brm(affect ~ affect_lagged + (affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(wb_lag_fit)[1]-bayes_R2(wb_lag_fit_empty)[1]
es <- sqrt(diff)
es

save(wb_lag_fit, file = "brm_fits/lagttuse_wellbeing_fit.Rda")
save(wb_lag_fit_empty, file = "brm_fits/lagttuse_wellbeing_fit_empty.Rda")

```

## dividing variances

```{r}

df$used_tt_cent <- calc.mcent(used_tt, id=random_id, data=df, na.rm=TRUE)
df$used_tt_mean <- calc.mean(used_tt, id=random_id, data=df, na.rm=TRUE, expand=TRUE)

wb_variances_fit <- brm(affect ~ used_tt_cent + used_tt_mean + used_tt_lagged + affect_lagged + (used_tt_cent +  used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(wb_variances_fit)

wb_variances_fit_empty <- brm(affect ~ used_tt_mean + used_tt_lagged + affect_lagged + (used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)
summary(wb_variances_fit_empty)

diff <- bayes_R2(wb_variances_fit)[1]-bayes_R2(wb_variances_fit_empty)[1]
es <- sqrt(diff)
es

save(wb_variances_fit, file = "brm_fits/divariances_wellbeing_fit.Rda")
save(wb_variances_fit_empty, file = "brm_fits/divariances_wellbeing_fit_empty.Rda")

```

## twitter use x well-being (age interaction)

```{r}

df$used_tt_lagged <- lagvar(used_tt, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$affect_lagged <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

wb_age_fit <- brm(affect ~ used_tt*age + used_tt_lagged + affect_lagged + (used_tt*age +  used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

summary(wb_age_fit)

save(wb_age_fit, file = "brm_fits/wellbeing_age_fit.Rda")

```


## twitter use x well-being (gender interaction)

```{r}

df$used_tt_lagged <- lagvar(used_tt, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$affect_lagged <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$Sex <- as.factor(df$Sex)

wb_sex_fit <- brm(affect ~ used_tt*Sex + used_tt_lagged + affect_lagged + (used_tt*Sex +  used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

summary(wb_sex_fit)

save(wb_sex_fit, file = "brm_fits/wellbeing_sex_fit.Rda")

```

## idea :
code not using twitter as NA
interact escapism with twitter use?

## twitter use x well-being (social media addiction)

```{r}

df$used_tt_cent <- calc.mcent(used_tt, id=random_id, data=df, na.rm=TRUE)
df$used_tt_lagged <- lagvar(used_tt, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$affect_lagged <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)


wb_add_fit <- brm(affect ~ used_tt_cent*SM_addiction + used_tt_lagged + affect_lagged + (used_tt_cent*SM_addiction +  used_tt_lagged + affect_lagged | random_id), data=df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

summary(wb_add_fit)

save(wb_add_fit, file = "brm_fits/wellbeing_addiction_fit.Rda")

```


## twitter behaviors x sense of belonging

```{r}
df$sense_community_lagged <- lagvar(sense_community, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

behaviors_belonging_fit <- brm(sense_community ~ sense_community_lagged + w_rt + w_liked + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled + (sense_community_lagged + + w_rt + w_liked + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

summary(behaviors_belonging_fit)

save(behaviors_belonging_fit, file = "brm_fits/behaviors_belonging_fit.Rda")

```
see which one is significant

comment, visited profile, followed trending topic
calculate effect size

effect size of commenting:

```{r}

df$sense_community_lagged <- lagvar(sense_community, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

commenting_belonging_fit_empty <- brm(sense_community ~ sense_community_lagged + w_tweeted + w_messaged + w_visited + w_trending + w_scrolled + (sense_community_lagged + w_tweeted + w_messaged + w_visited + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(behaviors_belonging_fit)[1]-bayes_R2(commenting_belonging_fit_empty)[1]
es <- sqrt(diff)
es

```

effect size of visiting profile:
```{r}
# behaviors_belonging_fit <- brm(sense_community ~ sense_community_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled + (sense_community_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

visiting_belonging_fit <- brm(sense_community ~ sense_community_lagged + w_tweeted + w_commented + w_messaged  + w_trending + w_scrolled + (sense_community_lagged + w_tweeted + w_commented + w_messaged + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(behaviors_belonging_fit)[1]-bayes_R2(visiting_belonging_fit)[1]
es <- sqrt(diff)
es

```

effect size of following a trending topic:
```{r}
# behaviors_belonging_fit <- brm(sense_community ~ sense_community_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled + (sense_community_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

trending_belonging_fit <- brm(sense_community ~ sense_community_lagged + w_tweeted + w_commented + w_messaged + w_visited +  w_scrolled + (sense_community_lagged +  w_commented + w_messaged + w_visited + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(behaviors_belonging_fit)[1]-bayes_R2(trending_belonging_fit)[1]
es <- sqrt(diff)
es

```

```{r}

behaviors_belonging_fit_empty <- brm(sense_community ~ sense_community_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled + (sense_community_lagged + w_tweeted + w_commented + w_messaged + w_visited + w_trending + w_scrolled|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

# effect size for scrolling down the feed
diff <- bayes_R2(ttb_fit)[1]-bayes_R2(ttb_fit_empty)[1]
es <- sqrt(diff)
es

save(ttb_fit, file = "brm_fits/ttbehaviors_wellbeing_fit.Rda")
save(ttb_fit_empty, file = "brm_fits/ttbehaviors_wellbeing_fit_empty.Rda")

```


## twitter functions x sense of belonging


```{r}

df$sense_community_lag <- lagvar(sense_community, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

func_belonging_fit <- brm(sense_community ~ sense_community_lag + distract + entertain + promote + information + interact+ (sense_community_lag + distract + entertain + promote + information + interact | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=7)

summary(func_belonging_fit)

save(func_belonging_fit, file = "brm_fits/func_belonging_fit.Rda")
```

calculate effect size for significant predictors
```{r}

func_belonging_fit_empty <- brm(sense_community ~ sense_community_lag + distract + entertain + promote + information + (sense_community_lag + distract + entertain + promote + information | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

diff <- bayes_R2(func_belonging_fit)[1]-bayes_R2(func_belonging_fit_empty)[1]
es <- sqrt(diff)
es

```

# Twitte Use x Polarization (no log)
```{r}

df$polarization_lag <- esmpack::lagvar(polarization.x, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

polarization_fit <- brm(polarization.x ~ polarization_lag + used_tt + used_tt_lagged + (polarization_lag + used_tt + used_tt_lagged | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

polarization_fit

polarization_fit_empty <- brm(polarization.x ~ polarization_lag + used_tt_lagged + (polarization_lag + used_tt_lagged| random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

diff <- bayes_R2(polarization_fit)[1]-bayes_R2(polarization_fit_empty)[1]
es <- sqrt(diff)
es


save(polarization_fit, file = "brm_fits/polarization_fit.Rda")
save(polarization_fit_empty, file = "brm_fits/polarization_fit_empty.Rda")

```

```{r}

a <- df %>% 
  group_by(random_id) %>% 
  summarise_at(vars(polarization.x), list(mean=mean))


hist(a$mean)

df$polarization_log <- log(df$polarization.x)


b <- df %>% 
  group_by(random_id) %>% 
  summarise_at(vars(polarization_log), list(mean=mean))


hist(b$mean)


```

## Twitter use x polarization (log)
ok, I don't know why it didn't work. I might need some help.

```{r}

df$polarization_log <- log(df$polarization.x)

df$polarization_log_lag <- esmpack::lagvar(polarization_log, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

polarization_log_fit <- brm(polarization_log ~ polarization_log_lag + used_tt + used_tt_lagged + (polarization_log_lag + used_tt + used_tt_lagged | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

polarization_log_fit

polarization_log_fit_empty <- brm(polarization_log ~ polarization_log_lag + used_tt_lagged + (polarization_log_lag + used_tt_lagged| random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

polarization_log_fit_empty

diff <- bayes_R2(polarization_log_fit)[1]-bayes_R2(polarization_log_fit_empty)[1]
es <- sqrt(diff)
es

```

## Interacting with others x polarization

```{r}

df$interact_other_lag <- esmpack::lagvar(interact_other, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

interact_other_fit <- brm(polarization.x ~ polarization_lag + interact_other + interact_other_lag + ( polarization_lag + interact_other + interact_other_lag | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=7)

interact_other_fit

interact_other_fit_empty <- brm(polarization.x ~ polarization_lag + interact_other_lag + ( polarization_lag + interact_other_lag | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=7)

save(interact_other_fit, file = "brm_fits/interact_other_fit.Rda")
save(interact_other_fit_empty, file = "brm_fits/interact_other_fit_empty.Rda")

diff <- bayes_R2(interact_other_fit_empty)[1]-bayes_R2(interact_other_fit)[1]
es <- sqrt(diff)
es

```

## tt use x outrage
```{r}

df$outrage <- df$angry + df$disgusted + df$repulsed

df$outrage_lag <- esmpack::lagvar(outrage, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

outrage_fit <- brm(outrage ~ outrage_lag + used_tt + used_tt_lagged + (outrage_lag + used_tt + used_tt_lagged | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

outrage_fit

outrage_fit_empty <- brm(outrage ~ outrage_lag + used_tt_lagged + (outrage_lag + used_tt_lagged | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

diff <- bayes_R2(outrage_fit)[1]-bayes_R2(outrage_fit_empty)[1]
es <- sqrt(diff)
es


save(outrage_fit, file = "brm_fits/outrage_fit.Rda")
save(outrage_fit_empty, file = "brm_fits/outrage_fit_empty.Rda")

```

## Outrage and Polarization
```{r}

df$outrage_lag <- esmpack::lagvar(outrage, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

outrage_polarization_fit <- brm(polarization.x ~ polarization_lag + outrage + outrage_lag + (outrage_lag + outrage + polarization_lag| random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

outrage_polarization_fit

outrage_polarization_fit_empty <- brm(polarization.x ~ polarization_lag + outrage_lag + (outrage_lag + polarization_lag| random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

diff <- bayes_R2(outrage_polarization_fit)[1]-bayes_R2(outrage_polarization_fit_empty)[1]
es <- sqrt(diff)
es


save(outrage_polarization_fit, file = "brm_fits/outrage_polarization_fit.Rda")
save(outrage_polarization_fit_empty, file = "brm_fits/outrage_polarization_fit_empty.Rda")


```

## Age interaction
```{r}

df$affect_lag <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$age.c <- scale(df$age,center = TRUE, scale = FALSE)
df$used_tt_mean <- esmpack::calc.mcent(x=used_tt, id=random_id, data=df, na.rm=TRUE)

age_fit <- brm(affect ~ affect_lag +  age.c + used_tt_mean + age.c * used_tt_mean +(age.c + used_tt_mean + affect_lag + age.c * used_tt_mean|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

age_fit

save(age_fit, file = "brm_fits/age_fit.Rda")

age_fit_empty <- brm(affect ~ affect_lag + age.c + used_tt_mean +(affect_lag + age.c + used_tt_mean|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=8)

save(age_fit_empty, file = "brm_fits/age_fit_empty.Rda")

age_fit2 <- add_criterion(age_fit, criterion = "loo", cores = 1)
age_fit_empty <- add_criterion(age_fit_empty, criterion = "loo", cores = 1)

comp <- loo_compare(age_fit2,  age_fit_empty)
print(comp, simplify = FALSE, digits = 3)

```


```{r}

df$affect_lag <- lagvar(affect, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)
df$used_tt_mean <- esmpack::calc.mcent(x=used_tt, id=random_id, data=df, na.rm=TRUE)

sex_fit <- brm(affect ~ affect_lag +  Sex + used_tt_mean + Sex * used_tt_mean +(Sex + used_tt_mean + affect_lag + Sex * used_tt_mean|random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

sex_fit

save(sex_fit, file = "brm_fits/sex_fit.Rda")

sex_fit_empty <- brm(affect ~ affect_lag +  Sex + used_tt_mean + (Sex + used_tt_mean + affect_lag |random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=6)

save(sex_fit_empty, file = "brm_fits/sex_fit_empty.Rda")

sex_fit2 <- add_criterion(sex_fit, criterion = "loo", cores = 1)
sex_fit_empty <- add_criterion(sex_fit_empty, criterion = "loo", cores = 1)

comp <- loo_compare(sex_fit2,  sex_fit_empty)
print(comp, simplify = FALSE, digits = 3)

```

## Interacting with others x outrage

```{r}

df$interact_other_lag <- esmpack::lagvar(interact_other, id=random_id, obs=obs, day=days_elapsed, data=df, lag=1)

df$outrage <- (df$disgusted + df$repulsed + df$angry)/3
df$outrage_lagged <- lagvar(outrage, id=random_id, obs=obs, day=days_elapsed, data=df, lag = 1)

interact_other_outrage_fit <- brm(outrage ~ outrage_lagged + interact_other + interact_other_lag + (outrage_lagged + interact_other + interact_other_lag | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=7)

interact_other_outrage_fit

interact_other_outrage_fit_empty <- brm(outrage ~ outrage_lagged + interact_other_lag + (outrage_lagged + interact_other_lag | random_id), data = df, iter = 10000, control = list(adapt_delta = 0.99), cores=7)

save(interact_other_outrage_fit, file = "brm_fits/interact_other_outrage_fit.Rda")
save(interact_other_outrage_fit_empty, file = "brm_fits/interact_other_outrage_fit_empty.Rda")

diff <- bayes_R2(interact_other_outrage_fit)[1]-bayes_R2(interact_other_outrage_fit_empty)[1]
es <- sqrt(diff)
es

```

